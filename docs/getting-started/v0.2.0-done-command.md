# v0.2.0 - Done Command

**üéØ Goal:** Mark tasks as completed

**üì¶ Implementation:**

```rust
"done" => {
    if args.len() < 3 {
        return Err("Usage: todo done <number>".into());
    }
    
    let number: usize = args[2].parse()?;
    let content = fs::read_to_string("todos.txt")?;
    
    let mut lines: Vec<String> = content
        .lines()
        .map(|l| l.to_string())
        .collect();
    
    let index = number - 1;
    lines[index] = lines[index].replace("[ ]", "[x]");
    
    fs::write("todos.txt", lines.join("\n") + "\n")?;
    println!("‚úì Task marked as completed");
}
```

**üß† Key Concepts:**

### `.map().collect()` pattern

```rust
let mut lines: Vec<String> = content
    .lines()           // Iterator of &str
    .map(|l| l.to_string())  // Transform each &str ‚Üí String
    .collect();        // Gather into Vec<String>
```

This is the **iterator pattern** - lazy evaluation until `collect()`.

**Why this pattern?**

- `.lines()` returns an iterator (doesn't allocate yet)
- `.map()` transforms each item (still lazy)
- `.collect()` forces evaluation and builds the Vec

### Why `.to_string()` is needed

```rust
content.lines()  // Returns Iterator<Item = &str>
```

Each line is a **borrowed reference** (`&str`) to data in `content`. We need **owned** `String` values so we can:

1. Modify them (`.replace()`)
2. Store them in a Vec that outlives `content`

```rust
.map(|l| l.to_string())  // Converts &str ‚Üí String (owned)
```

### Parsing user input

```rust
let number: usize = args[2].parse()?;
```

**What's happening:**

- `args[2]` is a `String` (e.g., `"3"`)
- `.parse()` tries to convert it to `usize`
- `:usize` type annotation tells `parse()` what to produce
- `?` propagates error if user typed invalid number

**Error handling:**

```rust
// If user types "abc"
args[2].parse()?  // Returns Err ‚Üí propagated to main
// User sees: "Error: invalid digit found in string"
```

### Index conversion: 1-based ‚Üí 0-based

```rust
let number: usize = args[2].parse()?;  // User sees: 1, 2, 3...
let index = number - 1;                 // Vec uses: 0, 1, 2...
lines[index] = lines[index].replace("[ ]", "[x]");
```

**Why this matters:**

- Users think in 1-based numbers (1st task, 2nd task)
- Rust Vecs are 0-indexed
- Must convert to avoid off-by-one errors

### Writing back to file

```rust
fs::write("todos.txt", lines.join("\n") + "\n")?;
```

**Breaking it down:**

- `lines.join("\n")` - combines Vec elements with newlines between
- `+ "\n"` - adds final newline at end of file
- `fs::write()` - overwrites entire file with new content

**Why overwrite instead of append?**

- Can't "edit middle" of file efficiently
- Must read entire file, modify in memory, write back
- This is fine for small files (hundreds of tasks)

### The `.replace()` method

```rust
lines[index] = lines[index].replace("[ ]", "[x]");
```

**What it does:**

- Finds first occurrence of `"[ ]"`
- Replaces it with `"[x]"`
- Returns a **new String** (doesn't modify original)

**Example:**

```rust
let task = "[ ] Buy milk";
let done = task.replace("[ ]", "[x]");
// done = "[x] Buy milk"
// task is unchanged (because String is immutable)
```

**Limitations not handled yet:**

- ‚ùå No validation if index is out of bounds
- ‚ùå No check if task is already done
- ‚ùå Empty file would panic

**These will be fixed in v0.3.0 and v0.4.2**

**üîó Resources:**

- [Code v0.2.0](https://github.com/joaofelipegalvao/todo-cli/commit/a5626567103c1faa69c96caea1cab27ad6f89b14)
- [Full diff](https://github.com/joaofelipegalvao/todo-cli/compare/v0.1.0...v0.2.0)