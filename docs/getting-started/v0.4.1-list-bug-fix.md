# v0.4.1 - List Bug Fix

**ðŸŽ¯ Goal:** Handle empty lines properly in the list command

**ðŸ“¦ The Bug:**

**Before v0.4.1:**

```rust
"list" => match fs::read_to_string("todos.txt") {
    Ok(content) => {
        for (i, line) in content.lines().enumerate() {
            println!("{}. {}", i + 1, line);  // Shows empty lines!
        }
    }
    // ...
}
```

**Problem:**

```
File content:          Display output:
[ ] Task 1             1. [ ] Task 1
                       2.              â† Empty line!
[ ] Task 2             3. [ ] Task 2
```

**After v0.4.1:**

```rust
"list" => match fs::read_to_string("todos.txt") {
    Ok(content) => {
        let valid_lines: Vec<&str> = content
            .lines()
            .filter(|l| !l.trim().is_empty())  // â† The fix!
            .collect();
        
        if valid_lines.is_empty() {
            println!("No tasks");
        } else {
            for (i, line) in valid_lines.iter().enumerate() {
                println!("{}. {}", i + 1, line);
            }
        }
    }
    Err(_) => {
        println!("No tasks");
    }
}
```

**ðŸ§  Key Concepts:**

### Why `.trim()` is necessary

**Where do empty lines come from?**

```rust
// When we write file:
fs::write("todos.txt", lines.join("\n") + "\n")?;
//                                          â†‘ adds final newline

// File content:
"[ ] Task 1\n[ ] Task 2\n"
//                      â†‘ this creates an empty line when splitting
```

**Without trim:**

```rust
"[ ] Task 1\n[ ] Task 2\n".lines()
// Results in: ["[ ] Task 1", "[ ] Task 2", ""]
//                                            â†‘ empty string!
```

**With trim:**

```rust
.filter(|l| !l.trim().is_empty())
// "".trim() = "" (still empty) â†’ filtered out
// "   ".trim() = "" â†’ also filtered out (whitespace-only lines)
```

### The `.filter()` method

```rust
content.lines()
    .filter(|l| !l.trim().is_empty())
    .collect()
```

**How it works:**

- Takes each line from iterator
- Applies predicate: `!l.trim().is_empty()`
- Keeps only lines where predicate is `true`

**Example:**

```rust
let lines = vec!["Task 1", "", "  ", "Task 2"];
let valid: Vec<_> = lines.iter()
    .filter(|l| !l.trim().is_empty())
    .collect();
// Result: ["Task 1", "Task 2"]
```

### Improved empty file handling

**Also added check for empty list:**

```rust
if valid_lines.is_empty() {
    println!("No tasks");
} else {
    // display tasks
}
```

**Why this matters:**

- File exists but has only empty lines
- Better UX than showing nothing

### Edge cases now handled

âœ… Empty file  
âœ… File with only whitespace  
âœ… File with trailing newlines  
âœ… File with blank lines between tasks  

**Bug lesson:** Always test with "weird" input (empty files, extra newlines, whitespace).

**ðŸ”— Resources:**

- [Code v0.4.1](https://github.com/joaofelipegalvao/todo-cli/tree/v0.4.1)
- [Full diff](https://github.com/joaofelipegalvao/todo-cli/compare/v0.4.0...v0.4.1)